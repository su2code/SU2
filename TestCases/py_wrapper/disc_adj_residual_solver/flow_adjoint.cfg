%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                              %
% SU2 configuration file                                                       %
% Case description: Test residual-based adjoint solver with Python wrapper.    %
% Author: H. Patel                                                             %
% Date: 11 February 2025                                                       %
%                                                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ------------- DIRECT, ADJOINT, AND LINEARIZED PROBLEM DEFINITION ------------%
%
SOLVER = EULER
KIND_TURB_MODEL = NONE
KIND_DISC_ADJ = RESIDUALS
MATH_PROBLEM = DISCRETE_ADJOINT
OBJECTIVE_FUNCTION = LIFT

% -------------------- COMPRESSIBLE FREE-STREAM DEFINITION --------------------%
%
MACH_NUMBER = 0.3
AOA = 5.0
REF_DIMENSIONALIZATION = DIMENSIONAL
FREESTREAM_TEMPERATURE = 293.0
REYNOLDS_NUMBER = 7E6
REYNOLDS_LENGTH = 1.0

% ---------------------- REFERENCE VALUE DEFINITION ---------------------------%
%
REF_ORIGIN_MOMENT_X = 0.25
REF_ORIGIN_MOMENT_Y = 0.00
REF_ORIGIN_MOMENT_Z = 0.00
REF_LENGTH = 1.0
REF_AREA = 1.0

% -------------------- BOUNDARY CONDITION DEFINITION --------------------------%
%
MARKER_EULER = ( airfoil )
MARKER_FAR = ( farfield )
MARKER_DEFORM_MESH = ( airfoil )
MARKER_FLUID_LOAD = ( airfoil )
MARKER_PLOTTING = ( airfoil )
MARKER_MONITORING = ( airfoil )

% ------------- COMMON PARAMETERS DEFINING THE NUMERICAL METHOD ---------------%
%
NUM_METHOD_GRAD = WEIGHTED_LEAST_SQUARES
CFL_NUMBER = 100000.0
CFL_ADAPT = NO
CFL_ADAPT_PARAM = ( 0.66667, 2.0, 1.0, 10000.0 )
RK_ALPHA_COEFF = ( 0.66667, 0.66667, 1.000000 )

LINEAR_SOLVER = FGMRES
LINEAR_SOLVER_PREC = ILU
LINEAR_SOLVER_ERROR = 1E-5
LINEAR_SOLVER_ITER = 5

MGLEVEL = 0
MGCYCLE = V_CYCLE

% -------------------- FLOW NUMERICAL METHOD DEFINITION -----------------------%
%
CONV_NUM_METHOD_FLOW = JST
MUSCL_FLOW = YES
JST_SENSOR_COEFF = ( 0.5, 0.01 )
TIME_DISCRE_FLOW = EULER_IMPLICIT

% -------------------- TURBULENT NUMERICAL METHOD DEFINITION ------------------%
%
CONV_NUM_METHOD_TURB = SCALAR_UPWIND
MUSCL_TURB = NO
TIME_DISCRE_TURB = EULER_IMPLICIT

% --------------------------- MESH PARAMETERS ---------------------------------%
%
DEFORM_MESH = YES
DEFORM_STIFFNESS_TYPE = WALL_DISTANCE
DEFORM_POISSONS_RATIO = 1E6

DEFORM_LINEAR_SOLVER = CONJUGATE_GRADIENT
DEFORM_LINEAR_SOLVER_PREC = ILU
DEFORM_LINEAR_SOLVER_ERROR = 1E-8
DEFORM_LINEAR_SOLVER_ITER = 1000
DEFORM_CONSOLE_OUTPUT = NO

READ_BINARY_RESTART = NO

% --------------------------- CONVERGENCE PARAMETERS --------------------------%
%
CONV_FIELD = REL_RMS_DENSITY
CONV_RESIDUAL_MINVAL = -12
WINDOW_CAUCHY_CRIT = NO
CONV_WINDOW_FIELD = (TAVG_DRAG, TAVG_LIFT)
CONV_WINDOW_STARTITER = 0
CONV_WINDOW_CAUCHY_EPS = 1E-3
CONV_WINDOW_CAUCHY_ELEMS = 10

WINDOW_START_ITER= 1000
WINDOW_FUNCTION= HANN_SQUARE

% ------------------------- INPUT/OUTPUT INFORMATION --------------------------%
%
HISTORY_WRT_FREQ_INNER = 0
SCREEN_WRT_FREQ_INNER = 1

MESH_FILENAME = naca_mesh.su2
MESH_FORMAT = SU2

MESH_OUT_FILENAME = mesh.deformed.su2
SOLUTION_FILENAME = solution_flow.dat
RESTART_FILENAME = restart_flow.dat
RESTART_ADJ_FILENAME = restart_adjoint_flow.dat
SOLUTION_ADJ_FILENAME = solution_adjoint_flow.dat

TABULAR_FORMAT = TECPLOT
OUTPUT_FILES = (RESTART, TECPLOT, TECPLOT_ASCII, SURFACE_TECPLOT, SURFACE_TECPLOT_ASCII, CSV, SURFACE_CSV)

CONV_FILENAME = history
VOLUME_FILENAME = flow
SURFACE_FILENAME = surface_flow

SCREEN_OUTPUT = (INNER_ITER, RMS_DENSITY, REL_RMS_DENSITY, AVG_CFL, RMS_ADJ_DENSITY)
HISTORY_OUTPUT = ITER, FLOW_COEFF, AERO_COEFF, AOA, RMS_RES, REL_RMS_RES, SENSITIVITY
